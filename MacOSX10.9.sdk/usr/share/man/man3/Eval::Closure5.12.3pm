.\" Automatically generated by Pod::Man 2.23 (Pod::Simple 3.14)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.ie \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.el \{\
.    de IX
..
.\}
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "Eval::Closure 3"
.TH Eval::Closure 3 "2011-06-05" "perl v5.12.5" "User Contributed Perl Documentation"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
Eval::Closure \- safely and cleanly create closures via string eval
.SH "VERSION"
.IX Header "VERSION"
version 0.06
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
.Vb 1
\&  use Eval::Closure;
\&
\&  my $code = eval_closure(
\&      source      => \*(Aqsub { $foo++ }\*(Aq,
\&      environment => {
\&          \*(Aq$foo\*(Aq => \e1,
\&      },
\&  );
\&
\&  warn $code\->(); # 1
\&  warn $code\->(); # 2
\&
\&  my $code2 = eval_closure(
\&      source => \*(Aqsub { $code\->() }\*(Aq,
\&  ); # dies, $code isn\*(Aqt in scope
.Ve
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
String eval is often used for dynamic code generation. For instance, \f(CW\*(C`Moose\*(C'\fR
uses it heavily, to generate inlined versions of accessors and constructors,
which speeds code up at runtime by a significant amount. String eval is not
without its issues however \- it's difficult to control the scope it's used in
(which determines which variables are in scope inside the eval), and it can be
quite slow, especially if doing a large number of evals.
.PP
This module attempts to solve both of those problems. It provides an
\&\f(CW\*(C`eval_closure\*(C'\fR function, which evals a string in a clean environment, other
than a fixed list of specified variables. It also caches the result of the
eval, so that doing repeated evals of the same source, even with a different
environment, will be much faster (but note that the description is part of the
string to be evaled, so it must also be the same (or non-existent) if caching
is to work properly).
.SH "FUNCTIONS"
.IX Header "FUNCTIONS"
.SS "eval_closure(%args)"
.IX Subsection "eval_closure(%args)"
This function provides the main functionality of this module. It is exported by
default. It takes a hash of parameters, with these keys being valid:
.IP "source" 4
.IX Item "source"
The string to be evaled. It should end by returning a code reference. It can
access any variable declared in the \f(CW\*(C`environment\*(C'\fR parameter (and only those
variables). It can be either a string, or an arrayref of lines (which will be
joined with newlines to produce the string).
.IP "environment" 4
.IX Item "environment"
The environment to provide to the eval. This should be a hashref, mapping
variable names (including sigils) to references of the appropriate type. For
instance, a valid value for environment would be \f(CW\*(C`{ \*(Aq@foo\*(Aq => [] }\*(C'\fR (which
would allow the generated function to use an array named \f(CW@foo\fR). Generally,
this is used to allow the generated function to access externally defined
variables (so you would pass in a reference to a variable that already exists).
.IP "description" 4
.IX Item "description"
This lets you provide a bit more information in backtraces. Normally, when a
function that was generated through string eval is called, that stack frame
will show up as \*(L"(eval n)\*(R", where 'n' is a sequential identifier for every
string eval that has happened so far in the program. Passing a \f(CW\*(C`description\*(C'\fR
parameter lets you override that to something more useful (for instance,
Moose overrides the description for accessors to something like \*(L"accessor
foo at MyClass.pm, line 123\*(R").
.IP "line" 4
.IX Item "line"
This lets you override the particular line number that appears in backtraces,
much like the \f(CW\*(C`description\*(C'\fR option. The default is 1.
.IP "terse_error" 4
.IX Item "terse_error"
Normally, this function appends the source code that failed to compile, and
prepends some explanatory text. Setting this option to true suppresses that
behavior so you get only the compilation error that Perl actually reported.
.SH "BUGS"
.IX Header "BUGS"
No known bugs.
.PP
Please report any bugs through \s-1RT:\s0 email
\&\f(CW\*(C`bug\-eval\-closure at rt.cpan.org\*(C'\fR, or browse to
http://rt.cpan.org/NoAuth/ReportBug.html?Queue=Eval\-Closure <http://rt.cpan.org/NoAuth/ReportBug.html?Queue=Eval-Closure>.
.SH "SUPPORT"
.IX Header "SUPPORT"
You can find this documentation for this module with the perldoc command.
.PP
.Vb 1
\&    perldoc Eval::Closure
.Ve
.PP
You can also look for information at:
.IP "\(bu" 4
AnnoCPAN: Annotated \s-1CPAN\s0 documentation
.Sp
http://annocpan.org/dist/Eval\-Closure <http://annocpan.org/dist/Eval-Closure>
.IP "\(bu" 4
\&\s-1CPAN\s0 Ratings
.Sp
http://cpanratings.perl.org/d/Eval\-Closure <http://cpanratings.perl.org/d/Eval-Closure>
.IP "\(bu" 4
\&\s-1RT:\s0 \s-1CPAN\s0's request tracker
.Sp
http://rt.cpan.org/NoAuth/Bugs.html?Dist=Eval\-Closure <http://rt.cpan.org/NoAuth/Bugs.html?Dist=Eval-Closure>
.IP "\(bu" 4
Search \s-1CPAN\s0
.Sp
http://search.cpan.org/dist/Eval\-Closure <http://search.cpan.org/dist/Eval-Closure>
.SH "AUTHOR"
.IX Header "AUTHOR"
Jesse Luehrs <doy at tozt dot net>
.PP
Based on code from Class::MOP::Method::Accessor, by Stevan Little and the
Moose Cabal.
.SH "SEE ALSO"
.IX Header "SEE ALSO"
.IP "\(bu" 4
Class::MOP::Method::Accessor
.Sp
This module is a factoring out of code that used to live here
.SH "COPYRIGHT AND LICENSE"
.IX Header "COPYRIGHT AND LICENSE"
This software is copyright (c) 2011 by Jesse Luehrs.
.PP
This is free software; you can redistribute it and/or modify it under
the same terms as the Perl 5 programming language system itself.
